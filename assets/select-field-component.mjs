function applyAttributes(t){const e=new Map(Object.entries(t));e.forEach(((t,e)=>this.hasOwnProperty(e)?this[e]=t:this.setAttribute(e,t)));for(const{name:t,value:s}of this.attributes)e.set(t,s);return e}const t="closed";function initShadowRoot(e){const{$template:s,template:i,delegatesFocus:a=!1,mode:n=t,serializable:r=!1}=e,l=this.attachShadow({delegatesFocus:a,mode:n,serializable:r});return DocumentFragment.prototype.isPrototypeOf(s)&&l.appendChild(s.cloneNode(!0)),"string"==typeof i&&l.setHTMLUnsafe(i),l}const e="c-select-field";class SelectField extends HTMLElement{#t=new AbortController;#e=new Map;#s=!1;#i;#a;#n;static formAssociated=!0;static observedAttributes=["aria-label","aria-expanded","aria-disabled","aria-readonly","onchange","value"];constructor(t={}){super(),this.#a=applyAttributes.call(this,{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-expanded":!1,exportparts:"button, choice, listbox",role:"combobox",tabindex:0,...t}),this.#n=initShadowRoot.call(this,{template:'<link href="http://assets.protosite.rocks/core/select-field.css" rel="stylesheet" type="text/css"><style type="text/css">:host(:defined) {\n\tcontent-visibility: hidden;\n}\n:host(:state(loaded)) {\n\tcontent-visibility: visible;\n}</style><div aria-activedescendant="true" aria-controls="listbox_popover" id="button" role="button"><div part="active_option" role="status"></div></div><slot name="listbox"><div aria-labelledby="button" id="listbox_popover" role="listbox" part="listbox"><slot></slot></div></slot>',delegatesFocus:!0}),this.#e=this.#r(),this.#i=this.#l(),this.#o("defined")}connectedCallback(){this.#d(),this.#h(),this.#o("interactive"),this.#c("link").onload=()=>this.#o("loaded")}disconnectedCallback(){this.#t.abort(),this.#s=!1}adoptedCallback(){}attributeChangedCallback(t,e,s){if(!1!==this.isConnected&&e!==s)switch(t){case"aria-disabled":this.disabled="true"===(this.#i.ariaDisabled=s);break;case"aria-expanded":this.expanded="true"===(this.#i.ariaExpanded=s);break;case"aria-label":this.#u.ariaLabel=s;break;case"value":this.value=s;break;default:this.#d()}}formAssociatedCallback(t){}formDisabledCallback(t){this.setAttribute("aria-disabled",t)}formResetCallback(){applyAttributes.call(this,this.#a)}formStateRestoreCallback(t,e){this.value=t}updateValidity(t){t.length>=2?this.#i.setValidity({}):(this.#i.setValidity({tooShort:!0},"value is too short",this.#n.firstChild),this.#i.reportValidity())}search(t){for(const[e,s]of this.#e)if(0===s.label.indexOf(t)||0===s.value.indexOf(t))return{$element:e.deref(),...s};return null}findByValue(t){for(const[e,s]of this.#e)if(t===s.value)return{$element:e.deref(),...s};return null}toggle(t=null){const e=t??(this.expanded?"collapsed":"expanded");return this[e]=!0,e}get form(){return this.#i.form}get name(){return this.getAttribute("name")??"unknown"}get type(){return this.getAttribute("type")??"text"}get value(){return this.#i.ariaValueNow}set value(t){this.#i.ariaValueNow=t,this.setAttribute("value",t),this.dispatchEvent(new Event("change"))}get interactive(){return this.#s}get#b(){return this.#i.states}get disabled(){return this.#i.ariaDisabled}set disabled(t){t?(this.#b.add("disabled"),this.disconnectedCallback()):this.#b.has("disabled")&&(this.#b.delete("disabled"),this.#h()),this.setAttribute("aria-disabled",t),this.setAttribute("tabindex",this.disabled?"-1":this.#a.get("tabindex"))}get expanded(){return"true"===this.#i.ariaExpanded}set expanded(t){this.setAttribute("aria-expanded",t),this.#b[t?"add":"delete"]("expanded"),this.#b[t?"delete":"add"]("collapsed")}set collapsed(t){this.expanded=!1===t}#o(t){return this.#b.add(t),this}#h(){this.addEventListener("click",this.#p,{signal:this.#t.signal}),this.addEventListener("focus",this.#v,{signal:this.#t.signal}),this.addEventListener("blur",this.#g,{signal:this.#t.signal})}#f(){return!1===this.#s&&(this.addEventListener("click",this.#p,{signal:this.#t.signal}),this.addEventListener("keypress",this.#x,{signal:this.#t.signal}),this.#s=!0),this}#y(){return this.#s&&(this.removeEventListener("click",this.#p),this.removeEventListener("keypress",this.#x),this.#s=!1),this}#v(){this.#f()}#g(){this.#y(),this.toggle("collapsed")}#p(){this.toggle()}#x({key:t}){switch(t){case"Backspace":case"Enter":this.focused===this.#m&&this.toggle("expanded");break;case"Escape":this.focused!==this.#m&&this.toggle("collapsed");break;case"End":this.focus(this.#$);break;case"Home":this.focus(this.#k)}}#l(){const t=this.attachInternals();return t.ariaActiveDescendantElement=this.#c("[aria-activedescendant=true]"),console.assert(t.ariaActiveDescendantElement,"Attribute `[aria-activedescendant]` requires specifying for some child element"),t}#r(){const t=this.#e;return this.#A.addEventListener("slotchange",(()=>{const e=this.#E.assignedElements();for(const s of e)s.hasAttribute("role")&&"option"===s.role?t.set(new WeakRef(s),{label:s.textContent||s.dataset.value,value:s.dataset.value||s.textContent}):s.remove();(t=>{t.forEach(((t,e,s)=>Boolean(e.deref()?.isConnected)||s.delete(e)))})(t)}),{signal:this.#t.signal}),t}#d(){this.#i.ariaAutoComplete=this.ariaAutoComplete,this.#i.ariaDisabled=this.ariaDisabled,this.#i.ariaHasPopup=this.ariaHasPopup,this.#i.ariaExpanded=this.ariaExpanded,this.#i.ariaMultiSelectable=this.ariaMultiSelectable,this.#i.ariaPlaceholder=this.ariaPlaceholder,this.#i.role=this.role}#c(t,e){return(e??this.#n).querySelector(t)}get#C(){return this.#n.activeElement??this.#i.ariaActiveDescendantElement}set#C(t){null!==this.#C&&(this.#C.ariaActiveDescendant=null),t.ariaActiveDescendant=!0,this.#i.ariaActiveDescendantElement=t}get#m(){return this.#c("[role=button]")}get#u(){return this.#c("[role=status]",this.#m)}get#w(){return this.#c("[role=listbox]")}get#E(){return this.#w.children[0]}get#A(){return this.#c("slot[name=listbox]")}get#$(){return this.#c("[role=option]:last-of-type",this.#w)}get#k(){return this.#c("[role=option]:first-of-type",this.#w)}}customElements.define(e,SelectField);const s=customElements.get(e);export{s as default};
