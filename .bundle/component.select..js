var x=s=>typeof s=="string"?["off","false"].includes(s.trim().toLocaleLowerCase()):!s,h=x;var E=s=>typeof s=="string"?["on","true"].includes(s.trim().toLocaleLowerCase()):!!s,a=E;function v(s){let{$template:t,template:i,delegatesFocus:e=!1,mode:n="closed",serializable:o=!1}=s,l=this.attachShadow({delegatesFocus:e,mode:n,serializable:o});return t instanceof DocumentFragment&&l.appendChild(t.cloneNode(!0)),typeof i=="string"&&l.setHTMLUnsafe(i),l}var p=v;function A(s){var t=typeof s;return!!s&&(t=="object"||t=="function")}var f=A;function y(s,t,i){return(f(t)?Object.entries(t):[[t,i]]).forEach(([n,o])=>{let l=String(n);if(o===null)s.removeAttribute(l);else if(o instanceof Attr)s.setAttributeNode(o);else{let c=s.getAttributeNode(l),d=String(o);c!==null?c.value=d:s.setAttribute(l,d)}}),new Map(s.getAttributeNames().sort().map(n=>[n,s.getAttributeNode(n)]))}var u=y;var m=(d=>(d.Animation="--animating",d.Collapsed="--collapsed",d.Defined="--defined",d.Disabled="--disabled",d.Expanded="--expanded",d.Interactive="--interactive",d.Loaded="--loaded",d.Scrolled="--scrolled",d))(m||{}),r=m;var g=`<link href="http://assets.protosite.xyz/core/component.select.css" rel="stylesheet" type="text/css"/><style type="text/css">:host(:state(--defined)) {
	content-visibility: hidden;
}
:host(:state(--loaded)) {
	content-visibility: visible;
}</style><div id="button" aria-controls="listbox" role="button" tabindex="0"><div id="status" aria-placeholder="\u0412\u044B\u0431\u0440\u0430\u0442\u044C..." part="selectedcontent" role="status"></div></div><e-listbox id="picker" aria-labelledby="button" part="listbox" tabindex="0"><slot></slot></e-listbox>`;var b=class s extends HTMLElement{#n;#i=this.attachInternals();#a;#r;#s;#o;#u;static formAssociated=!0;static role="combobox";static tagName="c-select";static observedAttributes=["aria-disabled","aria-expanded","aria-multiselectable","aria-required"];static initAttributes(t,i){let e={"aria-atomic":!0,"aria-expanded":!1,exportparts:t.getAttribute("exportparts"),id:t.id,role:this.role,tabIndex:t.tabIndex},{internals:n,shadowRoot:o}=i;if(h(e.exportparts)&&o instanceof ShadowRoot){let l=o.querySelectorAll("[part]");l.length&&(e.exportparts=Array.from(l).map(c=>c.part.toString()).join(" "))}return h(e.id)&&t.isConnected&&(e.id=[this.role,Math.round(performance.now())].join("-")),t.isConnected&&e.tabIndex<0&&n instanceof ElementInternals&&n.form instanceof HTMLElement&&(e.tabIndex=0),u(t,e)}static initAccessibilityTree(t,i){let{internals:e,$listbox:n,$status:o}=i;e.ariaAtomic="true",e.ariaHasPopup="listbox",e.ariaLive="polite",e.role=this.role,e.ariaDisabled=a(t.ariaDisabled).toString(),e.ariaExpanded=a(t.ariaExpanded).toString(),e.ariaRequired=a(t.ariaRequired).toString(),e.ariaMultiSelectable=a(t.ariaMultiSelectable).toString(),n.ariaMultiSelectable=e.ariaMultiSelectable,o.ariaLabel=t.ariaLabel,o.ariaPlaceholder=t.ariaPlaceholder}constructor(){super(),this.#n=p.call(this,{template:g,delegatesFocus:!0}),s.initAttributes(this,{shadowRoot:this.#n}),this.#t.add(r.Defined)}attributeChangedCallback(t,i,e){if(this.isConnected===!1||i===e)return;let n=a(e),o=h(e);switch(t){case"aria-disabled":n?(this.#t.add(r.Disabled),this.#s?.abort()):this.#t.delete(r.Disabled),this.#i.ariaDisabled=n.toString();break;case"aria-expanded":this.#t.delete(o?r.Expanded:r.Collapsed),this.#t.add(n?r.Expanded:r.Collapsed),this.#i.ariaExpanded=n.toString(),this.#h();break;case"aria-multiselectable":this.#i.ariaMultiSelectable=n.toString();break;default:}}connectedCallback(){s.initAttributes(this,{internals:this.#i}),s.initAccessibilityTree(this,{$listbox:this.#e,$status:this.#d,internals:this.#i}),this.#b(),this.#m(),this.#A(),this.#t.add(r.Interactive);let t=this.#n.querySelector("link");t&&(t.onload=()=>this.#t.add(r.Loaded))}disconnectedCallback(){this.#r?.abort(),this.#s?.abort(),this.#a?.disconnect(),this.#o?.abort(),this.#u?.abort()}formResetCallback(){this.#e.formResetCallback()}hidePicker(){this.#t.has(r.Collapsed)||u(this,"aria-expanded",!1)}showPicker(){this.#t.has(r.Expanded)||u(this,"aria-expanded",!0)}get disabled(){return this.#t.has(r.Disabled)&&a(this.#i.ariaDisabled)&&a(this.ariaDisabled)}get expanded(){return this.#t.has(r.Expanded)&&a(this.#i.ariaExpanded)&&a(this.ariaExpanded)}get multiple(){return a(this.#i.ariaMultiSelectable)}get name(){return(this.dataset.name||this.getAttribute("name"))??""}get options(){return this.#e.options}get readonly(){return a(this.#i.ariaReadOnly)}get required(){return a(this.#i.ariaRequired)}get length(){return this.#e.length}get type(){return"select"+(this.multiple?"-multiple":"-one")}get value(){return this.#e.value}get#l(){let t=this.#n.getElementById("button");if(t===null)throw new Error("Button element not found but required!");return t}get#d(){let t=this.#n.getElementById("status");if(t===null)throw new Error("Element of the selected content not found but required!");return t}get#e(){let t=this.#n.getElementById("picker");if(t===null)throw new Error("Listbox element not found but required!");return t}get#t(){return this.#i.states}#b(){this.#r?.abort(),this.#r=new AbortController;let t={signal:this.#r.signal};return this.addEventListener("focus",i=>this.#f(i),t),this.addEventListener("blur",i=>this.#p(i),t),this.#r}#p(t){this.hidePicker(),this.#s?.abort()}#f(t){this.#x()}#m(){this.#o?.abort(),this.#o=new AbortController;let t={capture:!1,passive:!0,signal:this.#o.signal};return this.#e.addEventListener("beforeinput",i=>this.#c(i),t),this.#e.addEventListener("input",i=>{this.#g(i),this.#c(i)},t),this.#o}#g(t){let{label:i=null,value:e=null}=this.options[this.#e.selectedIndex]??{};this.#i.setFormValue(e),this.#d.innerText=i??"",e!==null&&this.hidePicker()}#x(){this.#s?.abort(),this.#s=new AbortController;let t={capture:!1,passive:!0,signal:this.#s.signal};return this.addEventListener("click",i=>this.#E(i),t),this.addEventListener("keydown",i=>this.#v(i),t),this.#y(this.#s.signal),this.#s}#E(t){this.expanded?this.hidePicker():this.showPicker()}#v(t){switch(t.key){case"ArrowDown":case"Enter":this.showPicker();break;case"ArrowUp":case"Escape":this.#l.focus(),this.hidePicker();break;default:return}}#A(){return this.#a?.disconnect(),this.#a=new MutationObserver(t=>t.forEach(i=>{if(i.type==="attributes"){let{attributeName:e}=i,n=e?i.target.getAttribute(e):null;e&&n?this.setAttribute(e,n):e&&this.removeAttribute(e)}})),this.#a.observe(this.#e,{attributes:!0,attributeFilter:["aria-activedescendant","aria-owns"]}),this}#y(t){this.#e.addEventListener("animationend",i=>this.#w(i),{signal:t})}#w(t){this.#t.delete(r.Animation),this.#h()}#c(t){let{bubbles:i,data:e,type:n}=t,o=Object.getPrototypeOf(t).constructor,l=new o(n,{bubbles:i,data:e});return this.dispatchEvent(l),this}#h(){let t=this.#t.has(r.Expanded),i=this.#t.has(r.Collapsed);t?(this.#e.focus(),this.#e.updateScrollbar()):this.#l.focus(),this.#e.ariaHidden=i.toString()}},q=b;export{q as default};
