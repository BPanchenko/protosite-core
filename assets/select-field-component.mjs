const t=(t,e)=>{const s=new Map(Object.entries(e));s.forEach(((e,s)=>t.hasOwnProperty(s)?t[s]=e:t.setAttribute(s,e)));for(const{name:e,value:i}of t.attributes)s.set(e,i);return s},e="closed";function s(t){const{$template:s,template:i,delegatesFocus:a=!1,mode:n=e,serializable:o=!1}=t,r=this.attachShadow({delegatesFocus:a,mode:n,serializable:o});return DocumentFragment.prototype.isPrototypeOf(s)&&r.appendChild(s.cloneNode(!0)),"string"==typeof i&&r.setHTMLUnsafe(i),r}const i="c-select-field";class SelectField extends HTMLElement{#t=new Map;#e;#s;#i;static formAssociated=!0;static observedAttributes=["aria-label","aria-placeholder","aria-expanded","aria-disabled","aria-readonly","onchange","value"];constructor(e={}){super(),this.#e=t(this,{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-expanded":!1,exportparts:"button, listbox, selectedcontent",role:"combobox",tabIndex:0,...e}),this.#i=s.call(this,{template:'<link href="http://assets.protosite.rocks/core/select-field.css" rel="stylesheet" type="text/css"><style type="text/css">:host(:defined) {\n\tcontent-visibility: hidden;\n}\n:host(:state(loaded)) {\n\tcontent-visibility: visible;\n}</style><div aria-controls="listbox_popover" id="button" role="button" tabindex="0"><div part="selectedcontent" role="status"></div></div><div aria-labelledby="button" id="listbox_popover" role="listbox" part="listbox" tabindex="1"><slot></slot></div>',delegatesFocus:!0}),this.#s=this.attachInternals(),this.#a(),this.#n("defined")}connectedCallback(){this.#o(),this.#r(),this.#n("interactive"),this.#l("link").onload=()=>this.#n("loaded")}disconnectedCallback(){this.#d?.abort(),this.#h?.abort(),this.#c?.abort()}adoptedCallback(){}attributeChangedCallback(t,e,s){if(!1!==this.isConnected&&e!==s)switch(t){case"aria-disabled":this.disabled="true"===(this.#s.ariaDisabled=s);break;case"aria-expanded":this.expanded="true"===(this.#s.ariaExpanded=s);break;case"aria-label":this.#u.ariaLabel=s;break;case"aria-placeholder":this.#u.ariaPlaceholder=s;break;case"value":this.value=s;break;default:this.#o()}}formAssociatedCallback(t){}formDisabledCallback(t){this.setAttribute("aria-disabled",t)}formResetCallback(){t(this,this.#e)}formStateRestoreCallback(t,e){this.value=t}updateValidity(t){t.length>=2?this.#s.setValidity({}):(this.#s.setValidity({tooShort:!0},"value is too short",this.#i.firstChild),this.#s.reportValidity())}search(t){for(const[e,s]of this.#t)if(0===s.label.indexOf(t)||0===s.value.indexOf(t))return{$element:e.deref(),...s};return null}findByValue(t){for(const[e,s]of this.#t)if(t===s.value)return{$element:e.deref(),...s};return null}toggle(t=null){const e=t??(this.expanded?"collapsed":"expanded");return this[e]=!0,e}get form(){return this.#s.form}get name(){return this.getAttribute("name")??"unknown"}get options(){const t=new Set;for(const[e,s]of this.#t)t.add(e.deref());return null}get type(){return this.getAttribute("type")??"text"}get size(){return this.#t.size}get value(){return this.#s.ariaValueNow}set value(t){this.#s.ariaValueNow=t,this.setAttribute("value",t),this.dispatchEvent(new Event("change"))}get interacting(){return Boolean(this.#d)&&!1===this.#d?.signal.aborted}get#b(){return this.#s.states}get disabled(){return"true"===this.#s.ariaDisabled}set disabled(t){t?(this.#b.add("disabled"),this.#d?.abort()):this.#b.has("disabled")&&this.#b.delete("disabled"),this.setAttribute("aria-disabled",t),this.setAttribute("tabindex",this.disabled?"-1":this.#e.get("tabindex"))}get expanded(){return"true"===this.#s.ariaExpanded}set expanded(t){this.setAttribute("aria-expanded",t),this.#b[t?"add":"delete"]("expanded"),this.#b[t?"delete":"add"]("collapsed")}set collapsed(t){this.expanded=!1===t}#n(t){return this.#b.add(t),this}#h;#r(){this.#h?.abort(),this.#h=new AbortController;const t={capture:!1,passive:!0,signal:this.#h.signal};return this.addEventListener("focus",(t=>this.#p(t)),t),this.addEventListener("focusin",(t=>this.#f(t)),t),this.addEventListener("blur",(t=>this.#g(t)),t),this.addEventListener("focusout",(t=>this.#C(t)),t),this.#h}#p(t){this.#x()}#f(t){}#g(t){}#C(t){this.toggle("collapsed"),this.#d?.abort()}#d;#x(){this.#d?.abort(),this.#d=new AbortController;const t={capture:!0,passive:!1,signal:this.#d.signal};return this.#v.addEventListener("click",(t=>this.#y(t)),t),this.#m.addEventListener("click",(t=>this.#k(t)),t),this.addEventListener("keypress",(t=>this.#E(t)),t),this.#d}#y(t){this.toggle()}#k(t){}#E(t){const{key:e}=t;switch(e){case"Backspace":case"Enter":this.focused===this.#v&&this.toggle("expanded");break;case"Escape":this.focused!==this.#v&&this.toggle("collapsed");break;case"End":this.options[this.size-1].focus();break;case"Home":this.options[0].focus()}}#c;#a(){this.#c?.abort(),this.#c=new AbortController;const t=this.#t,e=t=>t.forEach(((t,e,s)=>{const i=e.deref();Boolean(i.isConnected&&i.parentElement===this)||s.delete(e)}));return this.#m.children[0].addEventListener("slotchange",(s=>{const i=s.target.assignedElements();for(const e of i)if(e.hasAttribute("role")&&"option"===e.role){const s=e.ariaLabel||e.textContent;t.set(new WeakRef(e),{label:s,value:e.value||e.dataset.value||s})}else e.remove();e(t)}),{signal:this.#c.signal}),this.#c}#o(){this.#s.ariaActiveDescendantElement=this.#i.activeElement,this.#s.ariaAutoComplete=this.ariaAutoComplete,this.#s.ariaDisabled=this.ariaDisabled,this.#s.ariaHasPopup=this.ariaHasPopup,this.#s.ariaExpanded=this.ariaExpanded,this.#s.ariaMultiSelectable=this.ariaMultiSelectable,this.#s.ariaPlaceholder=this.ariaPlaceholder,this.#s.role=this.role}#l(t,e){return(e??this.#i).querySelector(t)}get#v(){return this.#l("[role=button]")}get#u(){return this.#l("[role=status]",this.#v)}get#m(){return this.#l("[role=listbox]")}}customElements.define(i,SelectField);const a=customElements.get(i);export{a as default};
