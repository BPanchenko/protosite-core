const t="closed";function e(e){const{$template:s,template:i,delegatesFocus:a=!1,mode:n=t,serializable:o=!1}=e,r=this.attachShadow({delegatesFocus:a,mode:n,serializable:o});return DocumentFragment.prototype.isPrototypeOf(s)&&r.appendChild(s.cloneNode(!0)),"string"==typeof i&&r.setHTMLUnsafe(i),r}const s="c-select-field";class SelectField extends HTMLElement{#t;#e;#s=new Map;static formAssociated=!0;static observedAttributes=["aria-disabled","aria-expanded","aria-label","aria-placeholder","aria-readonly","onchange","value"];constructor(){e.call(super(),{template:'<link href="http://assets.protosite.rocks/core/select-field.css" rel="stylesheet" type="text/css"><style type="text/css">:host(:defined) {\n\tcontent-visibility: hidden;\n}\n:host(:state(loaded)) {\n\tcontent-visibility: visible;\n}</style><div aria-controls="listbox_popover" id="button" role="button" tabindex="0"><div part="selectedcontent" role="status"></div></div><div aria-labelledby="button" id="listbox_popover" role="listbox" part="listbox" tabindex="1"><slot></slot></div>',delegatesFocus:!0}),this.#e=this.attachInternals(),this.#i(),this.#a(),this.#n.add("defined"),this.#o(),console.log(this.#e)}#a(){const t=this.#e.shadowRoot.querySelectorAll("[part]");console.log(t.entries());const e={role:this.#e.role};console.log(e)}#i(){this.#e.ariaAtomic=!0,this.#e.role="combobox"}connectedCallback(){this.#r(),this.#l(),this.#n.add("interactive"),this.#d("link").onload=()=>this.#n.add("loaded")}disconnectedCallback(){this.#h?.abort(),this.#c?.abort(),this.#u?.abort()}adoptedCallback(){}attributeChangedCallback(t,e,s){if(!1!==this.isConnected&&e!==s)switch(t){case"aria-disabled":this.disabled="true"===(this.#e.ariaDisabled=s);break;case"aria-expanded":this.expanded="true"===(this.#e.ariaExpanded=s);break;case"aria-label":this.#b.ariaLabel=s;break;case"aria-placeholder":this.#b.ariaPlaceholder=s;break;case"value":this.value=s;break;default:this.#r()}}formAssociatedCallback(t){}formDisabledCallback(t){this.setAttribute("aria-disabled",t)}formResetCallback(){((t,e)=>{const s=new Map(Object.entries(e));s.forEach(((e,s)=>t.hasOwnProperty(s)?t[s]=e:t.setAttribute(s,e)));for(const{name:e,value:i}of t.attributes)s.set(e,i)})(this,this.#t)}formStateRestoreCallback(t,e){this.value=t}search(t){for(const[e,s]of this.#s)if(0===s.label.indexOf(t)||0===s.value.indexOf(t))return{$element:e.deref(),...s};return null}findByValue(t){for(const[e,s]of this.#s)if(t===s.value)return{$element:e.deref(),...s};return null}toggle(t=null){const e=t??(this.expanded?"collapsed":"expanded");return this[e]=!0,e}get form(){return this.#e.form}get name(){return this.getAttribute("name")??"unknown"}get options(){const t=new Set;for(const[e,s]of this.#s)t.add(e.deref());return null}get type(){return this.getAttribute("type")??"text"}get size(){return this.#s.size}get value(){return this.#e.ariaValueNow}set value(t){this.#e.ariaValueNow=t,this.setAttribute("value",t),this.dispatchEvent(new Event("change"))}get interacting(){return Boolean(this.#h)&&!1===this.#h?.signal.aborted}get#n(){return this.#e.states}get disabled(){return"true"===this.#e.ariaDisabled}set disabled(t){t?(this.#n.add("disabled"),this.#h?.abort()):this.#n.has("disabled")&&this.#n.delete("disabled"),this.setAttribute("aria-disabled",t)}get expanded(){return"true"===this.#e.ariaExpanded}set expanded(t){this.setAttribute("aria-expanded",t),this.#n[t?"add":"delete"]("expanded"),this.#n[t?"delete":"add"]("collapsed")}set collapsed(t){this.expanded=!1===t}#c;#l(){this.#c?.abort(),this.#c=new AbortController;const t={capture:!1,passive:!0,signal:this.#c.signal};return this.addEventListener("focus",(t=>this.#p(t)),t),this.addEventListener("focusin",(t=>this.#f(t)),t),this.addEventListener("blur",(t=>this.#g(t)),t),this.addEventListener("focusout",(t=>this.#C(t)),t),this.#c}#p(t){this.#v()}#f(t){}#g(t){}#C(t){this.toggle("collapsed"),this.#h?.abort()}#h;#v(){this.#h?.abort(),this.#h=new AbortController;const t={capture:!0,passive:!1,signal:this.#h.signal};return this.#m.addEventListener("click",(t=>this.#x(t)),t),this.#k.addEventListener("click",(t=>this.#y(t)),t),this.addEventListener("keypress",(t=>this.#A(t)),t),this.#h}#x(t){this.toggle()}#y(t){}#A(t){const{key:e}=t;switch(e){case"Backspace":case"Enter":this.focused===this.#m&&this.toggle("expanded");break;case"Escape":this.focused!==this.#m&&this.toggle("collapsed");break;case"End":this.options[this.size-1].focus();break;case"Home":this.options[0].focus()}}#u;#o(){this.#u?.abort(),this.#u=new AbortController;const t=this.#s,e=t=>t.forEach(((t,e,s)=>{const i=e.deref();Boolean(i.isConnected&&i.parentElement===this)||s.delete(e)}));return this.#k.children[0].addEventListener("slotchange",(s=>{const i=s.target.assignedElements();for(const e of i)if(e.hasAttribute("role")&&"option"===e.role){const s=e.ariaLabel||e.textContent;t.set(new WeakRef(e),{label:s,value:e.value||e.dataset.value||s})}else e.remove();e(t)}),{signal:this.#u.signal}),this.#u}#r(){this.#e.ariaActiveDescendantElement=this.#e.shadowRoot.activeElement,this.#e.ariaAutoComplete=this.ariaAutoComplete,this.#e.ariaDisabled=this.ariaDisabled,this.#e.ariaHasPopup=this.ariaHasPopup,this.#e.ariaExpanded=this.ariaExpanded,this.#e.ariaMultiSelectable=this.ariaMultiSelectable,this.#e.ariaPlaceholder=this.ariaPlaceholder,this.#e.role=this.role}#d(t,e){return(e??this.#e.shadowRoot).querySelector(t)}get#m(){return this.#d("[role=button]")}get#b(){return this.#d("[role=status]",this.#m)}get#k(){return this.#d("[role=listbox]")}}customElements.define(s,SelectField);const i=customElements.get(s);export{SelectField,i as default,s as tagName};
