const t="closed";function e(e){const{$template:s,template:i,delegatesFocus:a=!1,mode:n=t,serializable:o=!1}=e,r=this.attachShadow({delegatesFocus:a,mode:n,serializable:o});return DocumentFragment.prototype.isPrototypeOf(s)&&r.appendChild(s.cloneNode(!0)),"string"==typeof i&&r.setHTMLUnsafe(i),r}const s=(t,e,s=null)=>{var i,a;return(a=typeof(i=e),!i||"object"!=a&&"function"!=a?[[e,s]]:Object.entries(e)).forEach((([e,s])=>null===s?t.removeAttribute(e):s instanceof Attr?t.setAttributeNode(s):"string"==typeof e?t.hasAttribute(e)?t.getAttributeNode(e).value=s:t.setAttribute(e,s):void 0)),new Map(t.getAttributeNames().sort().map((e=>[e,t.getAttributeNode(e)])))},i="c-select-field";class SelectField extends HTMLElement{#t;#e;#s;#i=this.attachInternals();#a=new Map;static formAssociated=!0;static role="combobox";static observedAttributes=["aria-disabled","aria-expanded","aria-label","aria-placeholder","aria-readonly","onchange","value"];constructor(){super(),e.call(this,{template:'<link href="http://assets.protosite.rocks/core/select-field.css" rel="stylesheet" type="text/css"><style type="text/css">:host(:defined) {\n\tcontent-visibility: hidden;\n}\n:host(:state(loaded)) {\n\tcontent-visibility: visible;\n}</style><div aria-controls="listbox_popover" id="button" role="button" tabindex="0"><div part="selectedcontent" role="status"></div></div><div aria-labelledby="button" id="listbox_popover" role="listbox" part="listbox" tabindex="1"><slot></slot></div>',delegatesFocus:!0}),this.#n(),this.#o(),this.#r.add("defined")}connectedCallback(){this.#n(),this.#l(),this.#d(),this.#r.add("interactive"),this.#h("link").onload=()=>this.#r.add("loaded")}disconnectedCallback(){this.#e?.abort(),this.#t?.abort(),this.#s?.abort()}adoptedCallback(){}attributeChangedCallback(t,e,s){if(!1!==this.isConnected&&e!==s)switch(t){case"aria-disabled":this.disabled="true"===(this.#i.ariaDisabled=s);break;case"aria-expanded":this.expanded="true"===(this.#i.ariaExpanded=s);break;case"aria-label":this.#c.ariaLabel=s;break;case"aria-placeholder":this.#c.ariaPlaceholder=s;break;case"value":this.value=s}}formAssociatedCallback(t){}formDisabledCallback(t){this.setAttribute("aria-disabled",t)}formResetCallback(){}formStateRestoreCallback(t,e){this.value=t}search(t){for(const[e,s]of this.#a)if(0===s.label.indexOf(t)||0===s.value.indexOf(t))return{$element:e.deref(),...s};return null}findByValue(t){for(const[e,s]of this.#a)if(t===s.value)return{$element:e.deref(),...s};return null}toggle(t=null){const e=t??(this.expanded?"collapsed":"expanded");return this[e]=!0,e}get form(){return this.#i.form}get name(){return this.getAttribute("name")??"unknown"}get options(){const t=new Set;for(const[e,s]of this.#a)t.add(e.deref());return null}get type(){return this.getAttribute("type")??"text"}get size(){return this.#a.size}get value(){return this.#i.ariaValueNow}set value(t){this.#i.ariaValueNow=t,this.setAttribute("value",t),this.dispatchEvent(new Event("change"))}get interacting(){return Boolean(this.#e)&&!1===this.#e?.signal.aborted}get disabled(){return"true"===this.#i.ariaDisabled}set disabled(t){t?(this.#r.add("disabled"),this.#e?.abort()):this.#r.has("disabled")&&this.#r.delete("disabled"),this.setAttribute("aria-disabled",t)}get expanded(){return"true"===this.#i.ariaExpanded}set expanded(t){s(this,"aria-expanded",t),this.#r[t?"add":"delete"]("expanded"),this.#r[t?"delete":"add"]("collapsed")}set collapsed(t){this.expanded=!1===t}#n(){const t={"aria-atomic":!0,role:SelectField.role};if(!1===this.hasAttribute("exportparts")){const e=this.#i.shadowRoot.querySelectorAll("[part]").values();e.length&&(t.exportparts=Array.from(e).map((t=>t.part.toString())).join(", "))}return this.isConnected&&this.tabIndex<0&&this.#i.form instanceof HTMLFormElement&&(t.tabindex=0),s(this,t)}#l(){this.#i.ariaAtomic=!0,this.#i.role=SelectField.role,this.#i.ariaAutoComplete="true"===this.ariaAutoComplete,this.#i.ariaDisabled="true"===this.ariaDisabled,this.#i.ariaExpanded="true"===this.ariaExpanded,this.#i.ariaHasPopup="true"===this.ariaHasPopup,this.#i.ariaMultiSelectable="true"===this.ariaMultiSelectable,this.#i.ariaPlaceholder=this.ariaPlaceholder}#o(){this.#s?.abort(),this.#s=new AbortController;const t=this.#a,e=t=>t.forEach(((t,e,s)=>{const i=e.deref();Boolean(i.isConnected&&i.parentElement===this)||s.delete(e)}));return this.#u.children[0].addEventListener("slotchange",(s=>{const i=s.target.assignedElements();for(const e of i)if(e.hasAttribute("role")&&"option"===e.role){const s=e.ariaLabel||e.textContent;t.set(new WeakRef(e),{label:s,value:e.value||e.dataset.value||s})}else e.remove();e(t)}),{signal:this.#s.signal}),this.#s}#d(){this.#t?.abort(),this.#t=new AbortController;const t={capture:!1,passive:!0,signal:this.#t.signal};return this.addEventListener("focus",(t=>this.#b(t)),t),this.addEventListener("focusin",(t=>this.#p(t)),t),this.addEventListener("blur",(t=>this.#f(t)),t),this.addEventListener("focusout",(t=>this.#g(t)),t),this.#t}#C(){this.#e?.abort(),this.#e=new AbortController;const t={capture:!0,passive:!1,signal:this.#e.signal};return this.#v.addEventListener("click",(t=>this.#m(t)),t),this.#u.addEventListener("click",(t=>this.#x(t)),t),this.addEventListener("keypress",(t=>this.#A(t)),t),this.#e}#b(t){this.#C(),this.#i.ariaActiveDescendantElement=this.#i.shadowRoot.activeElement}#p(t){}#f(t){}#g(t){this.toggle("collapsed"),this.#e?.abort()}#m(t){this.toggle()}#x(t){}#A(t){const{key:e}=t;switch(e){case"Backspace":case"Enter":this.focused===this.#v&&this.toggle("expanded");break;case"Escape":this.focused!==this.#v&&this.toggle("collapsed");break;case"End":this.options[this.size-1].focus();break;case"Home":this.options[0].focus()}}#h(t,e){return(e??this.#i.shadowRoot).querySelector(t)}get#v(){return this.#h("[role=button]")}get#c(){return this.#h("[role=status]",this.#v)}get#u(){return this.#h("[role=listbox]")}get#r(){return this.#i.states}}customElements.define(i,SelectField);const a=customElements.get(i);export{SelectField,a as default,i as tagName};
